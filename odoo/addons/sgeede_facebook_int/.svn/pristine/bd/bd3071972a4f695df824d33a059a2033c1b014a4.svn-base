from odoo import api, fields, models
import time
from datetime import datetime, timedelta
import requests
import json
from odoo.exceptions import UserError, ValidationError

class sgeede_facebook_post(models.Model):
    _name = "sgeede.facebook.post"
    _description = "Facebook Post"

    name = fields.Char('Name', required=True)
    line_ids = fields.One2many('sgeede.facebook.product', 'post_id',string="Active Product")
    comment_ids = fields.One2many('sgeede.facebook.comment', 'post_id', string="Comment")
    post_date = fields.Datetime('Post Date')
    type_post = fields.Char('Type Post')
    story = fields.Text('Story')
    message = fields.Char('Message')
    page_id = fields.Many2one('sgeede.facebook.page', 'Page', required=True)
    sum_comment = fields.Integer('Sum Comment', compute='_compute_sum_comment')
    id_post = fields.Char('ID Post')
    attachment_ids = fields.One2many('sgeede.facebook.attachment', 'post_id')

    @api.depends('comment_ids')
    def _compute_sum_comment(self):
        for line in self:
            if len(line.comment_ids) > 0:
                line.sum_comment = len(line.comment_ids)
            else:
                line.sum_comment = 0


    def reply_comment(self):
        print("sdksdksjdks")

    def action_read_all_comments(self):
        return {
            'type': 'ir.actions.act_window',
            'name': ('Facebook Comment'),
            'res_model': 'sgeede.facebook.comment',
            'view_type': 'list',
            'view_mode': 'list',
            'domain': [('post_id','=',self.id)],
            'context':{},
        }
    
class sgeede_facebook_attachment(models.Model):
    _name = "sgeede.facebook.attachment"
    _description = "Facebook Attachment"

    post_id = fields.Many2one('sgeede.facebook.post', 'Post ID')
    attachment_link = fields.Char('Link')
    attachment_type = fields.Char('Type')



    


