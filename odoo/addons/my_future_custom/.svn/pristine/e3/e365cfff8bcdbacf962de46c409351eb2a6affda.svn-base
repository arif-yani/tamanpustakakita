# -*- coding: utf-8 -*-
# Part of Odoo. See LICENSE file for full copyright and licensing details.
import base64
import datetime
import json
import os
import logging
import re
import requests
import werkzeug.urls
import werkzeug.utils
import werkzeug.wrappers

from itertools import islice
from lxml import etree, html
from textwrap import shorten
from werkzeug.exceptions import NotFound
from xml.etree import ElementTree as ET
from psycopg2 import IntegrityError
import threading

import odoo
from odoo import http, models, fields, _
from odoo.http import request, Response
from werkzeug.exceptions import BadRequest
from odoo.exceptions import AccessDenied, ValidationError, UserError



class MyFuture(http.Controller):


    @http.route('/webform', type="http", auth="public", website=True)
    def customer_webform(self, **kw):
        return http.request.render("my_future_custom.create_customer")  
    

    @http.route('/create/customer/<string:model_name>', type="http", auth="public", methods=['POST'], website=True)
    def create_customer(self,model_name, **kwargs):
        if kwargs['mobile'][:1] == '0':
            kwargs['mobile'] = '+62'+kwargs['mobile'][1:]
        else:
            kwargs['mobile'] = '+62'+kwargs['mobile']
        request.env['res.partner'].sudo().create(kwargs)
        # print("checkdaa", kwargs)
        request.redirect("/contactus")


    @http.route('/sgeede/webhook/get_post', methods=['GET','POST'] ,type='http', auth='public', csrf=False, website=True)
    def get_post(self, **post):
        if request.httprequest.method == 'POST':
            values = request.httprequest.data
            values = json.loads(values)
            x = threading.Thread(target=self.order_push_server, args=(values,))
            x.start()
        res = Response('Success', status=200)
        return res
    
    @http.route('/sgeede/webhook/whatsapp_api', methods=['GET','POST'] ,type='http', auth='public', csrf=False, website=True)
    def whatsapp_api(self, **post):
        if request.httprequest.method == 'POST':
            order_obj = request.env['sgeede.shopee.webhook']
            values = request.httprequest.data
            values = json.loads(values)
            x = threading.Thread(target=self.order_push_server, args=(values,))
            x.start()
        res = Response('Success', status=200)
        return res
