/*@odoo-module */
import { registry } from "@web/core/registry";
import { Component } from "@odoo/owl";

const actionRegistry = registry.category("actions");

class DashboardScanLabel extends Component {
    setup() {
        super.setup();
        this.barcode = "";
        this.onKeyDown = this.onKeyDown.bind(this);  // Bind the method to ensure correct context
        document.addEventListener('keydown', this.onKeyDown);
    }

    /**
     * Method untuk menangani input barcode.
     * @param {string} barcode - Barcode yang dipindai.
     */
    handleBarcodeInput(barcode) {
        console.log("Barcode dipindai:", barcode);
        // Tambahkan logika pemrosesan barcode di sini
        var ajax = $.ajax({
            method: 'POST',
            url: '/my_future/send_barcode',
            data: {
                'barcode': barcode,
            },
            dataType: 'json',
            success: function(data) {
                // data.forEach(function(rak){
                   
                // })
                console.log(data,"data")
            }
        })
    }

    /**
     * Event listener untuk menangkap input barcode.
     * @param {KeyboardEvent} event - Event keyboard.
     */
    onKeyDown(event) {
        if (event.key === 'Enter') {
            if (this.barcode) {
                this.handleBarcodeInput(this.barcode);
                this.barcode = "";
            }
        } else {
            this.barcode += event.key;
        }
    }

    willUnmount() {
        super.willUnmount();
        document.removeEventListener('keydown', this.onKeyDown);
    }
}

console.log("wwwwwwwwwwwwwwwwwwwwwwww");
console.log(this.barcode, "tes");

DashboardScanLabel.template = "my_future_custom.DashboardScanLabel";
// Tag name yang kita masukkan di langkah pertama.
actionRegistry.add("DashboardScanLabel.tag", DashboardScanLabel);

export default DashboardScanLabel;